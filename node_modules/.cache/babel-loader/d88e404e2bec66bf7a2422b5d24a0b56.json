{"ast":null,"code":"/**\n * @author Toru Nagashima <https://github.com/mysticatea>\n * See LICENSE file in root directory for full license.\n */\nimport { EventTarget, defineEventAttribute } from 'event-target-shim';\n/**\n * The signal class.\n * @see https://dom.spec.whatwg.org/#abortsignal\n */\n\nclass AbortSignal extends EventTarget {\n  /**\n   * AbortSignal cannot be constructed directly.\n   */\n  constructor() {\n    super();\n    throw new TypeError(\"AbortSignal cannot be constructed directly\");\n  }\n  /**\n   * Returns `true` if this `AbortSignal`'s `AbortController` has signaled to abort, and `false` otherwise.\n   */\n\n\n  get aborted() {\n    const aborted = abortedFlags.get(this);\n\n    if (typeof aborted !== \"boolean\") {\n      throw new TypeError(\"Expected 'this' to be an 'AbortSignal' object, but got \".concat(this === null ? \"null\" : typeof this));\n    }\n\n    return aborted;\n  }\n\n}\n\ndefineEventAttribute(AbortSignal.prototype, \"abort\");\n/**\n * Create an AbortSignal object.\n */\n\nfunction createAbortSignal() {\n  const signal = Object.create(AbortSignal.prototype);\n  EventTarget.call(signal);\n  abortedFlags.set(signal, false);\n  return signal;\n}\n/**\n * Abort a given signal.\n */\n\n\nfunction abortSignal(signal) {\n  if (abortedFlags.get(signal) !== false) {\n    return;\n  }\n\n  abortedFlags.set(signal, true);\n  signal.dispatchEvent({\n    type: \"abort\"\n  });\n}\n/**\n * Aborted flag for each instances.\n */\n\n\nconst abortedFlags = new WeakMap(); // Properties should be enumerable.\n\nObject.defineProperties(AbortSignal.prototype, {\n  aborted: {\n    enumerable: true\n  }\n}); // `toString()` should return `\"[object AbortSignal]\"`\n\nif (typeof Symbol === \"function\" && typeof Symbol.toStringTag === \"symbol\") {\n  Object.defineProperty(AbortSignal.prototype, Symbol.toStringTag, {\n    configurable: true,\n    value: \"AbortSignal\"\n  });\n}\n/**\n * The AbortController.\n * @see https://dom.spec.whatwg.org/#abortcontroller\n */\n\n\nclass AbortController {\n  /**\n   * Initialize this controller.\n   */\n  constructor() {\n    signals.set(this, createAbortSignal());\n  }\n  /**\n   * Returns the `AbortSignal` object associated with this object.\n   */\n\n\n  get signal() {\n    return getSignal(this);\n  }\n  /**\n   * Abort and signal to any observers that the associated activity is to be aborted.\n   */\n\n\n  abort() {\n    abortSignal(getSignal(this));\n  }\n\n}\n/**\n * Associated signals.\n */\n\n\nconst signals = new WeakMap();\n/**\n * Get the associated signal of a given controller.\n */\n\nfunction getSignal(controller) {\n  const signal = signals.get(controller);\n\n  if (signal == null) {\n    throw new TypeError(\"Expected 'this' to be an 'AbortController' object, but got \".concat(controller === null ? \"null\" : typeof controller));\n  }\n\n  return signal;\n} // Properties should be enumerable.\n\n\nObject.defineProperties(AbortController.prototype, {\n  signal: {\n    enumerable: true\n  },\n  abort: {\n    enumerable: true\n  }\n});\n\nif (typeof Symbol === \"function\" && typeof Symbol.toStringTag === \"symbol\") {\n  Object.defineProperty(AbortController.prototype, Symbol.toStringTag, {\n    configurable: true,\n    value: \"AbortController\"\n  });\n}\n\nexport default AbortController;\nexport { AbortController, AbortSignal };","map":null,"metadata":{},"sourceType":"module"}